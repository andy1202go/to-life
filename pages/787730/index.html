<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>为什么Spring的bean默认都是单例？ | to-life</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="https://cdn.staticaly.com/gh/eryajf/tu/main/img/image_20220720_132133.ico">
    <script language="javascript" type="text/javascript" src="/to-life/js/pgmanor-self.js"></script>
    <meta name="description" content="vdoing博客主题模板">
    <meta name="keywords" content="AL，生活不只是coding">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/to-life/assets/css/0.styles.64af5bd0.css" as="style"><link rel="preload" href="/to-life/assets/js/app.3dedcccd.js" as="script"><link rel="preload" href="/to-life/assets/js/4.c9433221.js" as="script"><link rel="preload" href="/to-life/assets/js/29.da8f1ff4.js" as="script"><link rel="prefetch" href="/to-life/assets/js/10.17408af5.js"><link rel="prefetch" href="/to-life/assets/js/11.26c78ec9.js"><link rel="prefetch" href="/to-life/assets/js/12.0272cc6e.js"><link rel="prefetch" href="/to-life/assets/js/13.ecdd708b.js"><link rel="prefetch" href="/to-life/assets/js/14.6cae2f5b.js"><link rel="prefetch" href="/to-life/assets/js/15.2af25a35.js"><link rel="prefetch" href="/to-life/assets/js/16.19929ab8.js"><link rel="prefetch" href="/to-life/assets/js/17.6af2a1b8.js"><link rel="prefetch" href="/to-life/assets/js/18.5d3adce5.js"><link rel="prefetch" href="/to-life/assets/js/19.4fe385d6.js"><link rel="prefetch" href="/to-life/assets/js/20.4d6f44c7.js"><link rel="prefetch" href="/to-life/assets/js/21.24d39167.js"><link rel="prefetch" href="/to-life/assets/js/22.5d687111.js"><link rel="prefetch" href="/to-life/assets/js/23.d160785a.js"><link rel="prefetch" href="/to-life/assets/js/24.656408c4.js"><link rel="prefetch" href="/to-life/assets/js/25.2e31275d.js"><link rel="prefetch" href="/to-life/assets/js/26.8893380c.js"><link rel="prefetch" href="/to-life/assets/js/27.7ae50bf1.js"><link rel="prefetch" href="/to-life/assets/js/28.097acc7d.js"><link rel="prefetch" href="/to-life/assets/js/30.dcadb76c.js"><link rel="prefetch" href="/to-life/assets/js/31.2d2eab4e.js"><link rel="prefetch" href="/to-life/assets/js/32.906dc02b.js"><link rel="prefetch" href="/to-life/assets/js/33.93f6270e.js"><link rel="prefetch" href="/to-life/assets/js/34.55370f60.js"><link rel="prefetch" href="/to-life/assets/js/35.103ede06.js"><link rel="prefetch" href="/to-life/assets/js/36.70a609d2.js"><link rel="prefetch" href="/to-life/assets/js/37.ccd58c2d.js"><link rel="prefetch" href="/to-life/assets/js/38.5da6d4ba.js"><link rel="prefetch" href="/to-life/assets/js/39.ffe0de54.js"><link rel="prefetch" href="/to-life/assets/js/40.745cf032.js"><link rel="prefetch" href="/to-life/assets/js/41.06fabf32.js"><link rel="prefetch" href="/to-life/assets/js/42.6f7ecc93.js"><link rel="prefetch" href="/to-life/assets/js/43.3bdf38ef.js"><link rel="prefetch" href="/to-life/assets/js/44.cd332ae8.js"><link rel="prefetch" href="/to-life/assets/js/45.beffecc8.js"><link rel="prefetch" href="/to-life/assets/js/46.e4d0c9f2.js"><link rel="prefetch" href="/to-life/assets/js/47.acb2d52d.js"><link rel="prefetch" href="/to-life/assets/js/48.6939e0be.js"><link rel="prefetch" href="/to-life/assets/js/49.6160d558.js"><link rel="prefetch" href="/to-life/assets/js/5.4537bedb.js"><link rel="prefetch" href="/to-life/assets/js/50.ac2399fc.js"><link rel="prefetch" href="/to-life/assets/js/51.38a91574.js"><link rel="prefetch" href="/to-life/assets/js/52.49239113.js"><link rel="prefetch" href="/to-life/assets/js/53.b524cfae.js"><link rel="prefetch" href="/to-life/assets/js/54.9ab15500.js"><link rel="prefetch" href="/to-life/assets/js/55.93513737.js"><link rel="prefetch" href="/to-life/assets/js/56.bd0acf20.js"><link rel="prefetch" href="/to-life/assets/js/57.b481fae7.js"><link rel="prefetch" href="/to-life/assets/js/58.7db0d64a.js"><link rel="prefetch" href="/to-life/assets/js/59.9301dc5c.js"><link rel="prefetch" href="/to-life/assets/js/6.48fefdff.js"><link rel="prefetch" href="/to-life/assets/js/60.8eac87ca.js"><link rel="prefetch" href="/to-life/assets/js/61.3f3427fd.js"><link rel="prefetch" href="/to-life/assets/js/62.be557e1f.js"><link rel="prefetch" href="/to-life/assets/js/63.a2c99e2a.js"><link rel="prefetch" href="/to-life/assets/js/7.64a7776c.js"><link rel="prefetch" href="/to-life/assets/js/8.cba6e367.js"><link rel="prefetch" href="/to-life/assets/js/9.8ebd4807.js"><link rel="prefetch" href="/to-life/assets/js/vendors~flowchart.3fe8bb1a.js"><link rel="prefetch" href="/to-life/assets/js/vendors~mermaid.010534d0.js">
    <link rel="stylesheet" href="/to-life/assets/css/0.styles.64af5bd0.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/to-life/" class="home-link router-link-active"><img src="https://cdn.staticaly.com/gh/eryajf/tu/main/img/image_20220720_132208.png" alt="to-life" class="logo"> <span class="site-name can-hide">to-life</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/to-life/" class="nav-link">首页</a></div><div class="nav-item"><a href="/to-life/rookie/" class="nav-link">入门</a></div><div class="nav-item"><a href="/to-life/behavior/" class="nav-link">修养</a></div><div class="nav-item"><a href="/to-life/basic/" class="nav-link">专业基础</a></div><div class="nav-item"><a href="/to-life/design/" class="nav-link">软件设计</a></div><div class="nav-item"><a href="/to-life/grow/" class="nav-link">高手成长</a></div><div class="nav-item"><a href="/to-life/learn/" class="nav-link">学习方式方法</a></div><div class="nav-item"><a href="/to-life/message-board/" class="nav-link">留言板</a></div> <a href="https://github.com/andy1202go/to-life" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/to-life/" class="nav-link">首页</a></div><div class="nav-item"><a href="/to-life/rookie/" class="nav-link">入门</a></div><div class="nav-item"><a href="/to-life/behavior/" class="nav-link">修养</a></div><div class="nav-item"><a href="/to-life/basic/" class="nav-link">专业基础</a></div><div class="nav-item"><a href="/to-life/design/" class="nav-link">软件设计</a></div><div class="nav-item"><a href="/to-life/grow/" class="nav-link">高手成长</a></div><div class="nav-item"><a href="/to-life/learn/" class="nav-link">学习方式方法</a></div><div class="nav-item"><a href="/to-life/message-board/" class="nav-link">留言板</a></div> <a href="https://github.com/andy1202go/to-life" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>零基础启蒙</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>与孩子一起学编程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/to-life/pages/c9397c/" class="sidebar-link">练习编程网站资源</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>入门语言 JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/to-life/pages/1424d7/" class="sidebar-link">JavaScript入门书籍和课程推荐</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>入门语言 Python</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/to-life/pages/3219ae/" class="sidebar-link">Python入门书籍和课程推荐</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>编程工具 Visual Studio Code</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/to-life/pages/d73567/" class="sidebar-link">VSCode入门书籍和课程推荐</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>Web 编程入门</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/to-life/pages/b03ed0/" class="sidebar-link">为什么选择web编程入门？</a></li><li><a href="/to-life/pages/b6c7f9/" class="sidebar-link">HTML入门书籍和课程推荐</a></li><li><a href="/to-life/pages/98c7e3/" class="sidebar-link">Node.js入门书籍和课程推荐</a></li><li><a href="/to-life/pages/0bc1ab/" class="sidebar-link">CSS入门书籍和课程推荐</a></li><li><a href="/to-life/pages/342ff9/" class="sidebar-link">PHP入门书籍和课程推荐</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>操作系统入门 Linux</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/to-life/pages/2f21e6/" class="sidebar-link">Linux入门书籍和课程推荐</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>实践项目</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/to-life/pages/a06792/" class="sidebar-link">简单的Blog系统，或是BBS系统</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>正式入门</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>编程技巧</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/to-life/pages/4a3445/" class="sidebar-link">编程技巧学习资源</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>编程语言</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/to-life/pages/787730/" aria-current="page" class="active sidebar-link">为什么Spring的bean默认都是单例？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/to-life/pages/787730/#_1-什么是单例" class="sidebar-link">1 什么是单例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/to-life/pages/787730/#_1-5-bean-scopes" class="sidebar-link">1.5. Bean Scopes</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/to-life/pages/787730/#_2-为什么说-在大多数情况下-单例bean是很理想的方案" class="sidebar-link">2 为什么说&quot;在大多数情况下，单例bean是很理想的方案&quot;？</a></li><li class="sidebar-sub-header level2"><a href="/to-life/pages/787730/#_3-多聊一下对象的状态-以及单例模式" class="sidebar-link">3 多聊一下对象的状态，以及单例模式</a></li><li class="sidebar-sub-header level2"><a href="/to-life/pages/787730/#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/to-life/pages/e71bfc/" class="sidebar-link">Java核心技术卷1（原书第9版）目录及概述</a></li><li><a href="/to-life/pages/db5341/" class="sidebar-link">Spring实战（第4版）目录及概述</a></li><li><a href="/to-life/pages/32c15f/" class="sidebar-link">编程语言学习资源</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>操作系统</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/to-life/pages/b3914e/" class="sidebar-link">操作系统学习资源</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>网络协议</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/to-life/pages/28e1b6/" class="sidebar-link">网络协议学习资源</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>数据库设计</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/to-life/pages/94d79f/" class="sidebar-link">数据库设计学习资源</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>前端方面</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/to-life/pages/40e3b8/" class="sidebar-link">前端方面学习资源</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>字符编码方面</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/to-life/pages/f8382d/" class="sidebar-link">字符编码方面入门学习资源</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>编程工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/to-life/pages/f68226/" class="sidebar-link">编程工具入门学习资源</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>实践项目</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/to-life/pages/2f319d/" class="sidebar-link">投票系统</a></li></ul></section></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/to-life/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/to-life/rookie/#入门" data-v-06225672>入门</a></li><li data-v-06225672><a href="/to-life/rookie/#正式入门" data-v-06225672>正式入门</a></li><li data-v-06225672><a href="/to-life/rookie/#编程语言" data-v-06225672>编程语言</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/andy1202go" target="_blank" title="作者" class="beLink" data-v-06225672>AL</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-08-25</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">为什么Spring的bean默认都是单例？<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p>出现这个问题，是因为看了一篇公众号文章，原文不太好找了，大致意思是说，单例情况下，怎么保证高并发。</p> <p>看到文章题目的时候，就想，这东西的并发还用保证么？或者说，跟单例有个jimao关系呢？？？通篇看下来，好像也是这样，也是很短小的技术向的总结性文章了。</p> <p>但是拐头一想，好像接触编码之后，或者说一直以来在使用Spring的时候，好像都没关注过bean的scope。有印象的是什么情况呢？</p> <p>是大佬的代码中出现了prototype的时候，查一下，哦是多例。</p> <p>嗯？那平时的是啥？哦是单例。</p> <p>嗯？那单例是啥？哦是上下文中只有这么一个bean。</p> <p>嗯？为啥要这样？没查到。弱弱的问下大佬，大佬说那你为啥要多个bean？单个bean不就够了么？</p> <p>好像是那么回事，好像又没明白。今天就一起从头看下。</p> <h2 id="_1-什么是单例"><a href="#_1-什么是单例" class="header-anchor">#</a> 1 什么是单例</h2> <p>首先想到的是去查书<a href="/to-life/01.入门/02.正式入门/02.编程语言/98.Spring实战（第4版）目录及概述.html">Spring in action 第4版</a>。在这本说的3.4章节bean的作用域（哦，scope的中文翻译是这个）写道：</p> <blockquote><p>在默认情况下，Spring应用上下文中所有bean都是作为以单例的形式创建的。也就是说，不管给定的一个bean被注入到其他bean多少次，每次所注入的都是同一个实例。</p> <p>在大多数情况下，单例bean是很理想的方案。初始化和垃圾回收对象实例所带来的成本只留给一些小规模任务...</p> <ul><li>单例（Singleton）：在整个应用中，只创建bean的一个实例。</li></ul></blockquote> <p>呃，看完之后，大概只知道单例的定义是什么，但是为什么要区分作用域其实不是很明确。</p> <p>考虑到Spring in action倾向于操作，我们找下<a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>怎么说。</p> <blockquote><h3 id="_1-5-bean-scopes"><a href="#_1-5-bean-scopes" class="header-anchor">#</a> 1.5. Bean Scopes</h3> <p>When you create a bean definition, you create a recipe for creating actual instances of the class defined by that bean definition. The idea that a bean definition is a recipe is important, because it means that, as with a class, you can create many object instances from a single recipe.</p> <p>You can control not only the various dependencies and configuration values that are to be plugged into an object that is created from a particular bean definition but also control the scope of the objects created from a particular bean definition. This approach is powerful and flexible, because you can choose the scope of the objects you create through configuration instead of having to bake in the scope of an object at the Java class level. Beans can be defined to be deployed in one of a number of scopes. The Spring Framework supports six scopes, four of which are available only if you use a web-aware <code>ApplicationContext</code>. You can also create <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-custom" target="_blank" rel="noopener noreferrer">a custom scope.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>The following table describes the supported scopes:</p> <table><thead><tr><th style="text-align:left;">Scope</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-singleton" target="_blank" rel="noopener noreferrer">singleton<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">(Default) Scopes a single bean definition to a single object instance for each Spring IoC container.</td></tr> <tr><td style="text-align:left;"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-prototype" target="_blank" rel="noopener noreferrer">prototype<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">Scopes a single bean definition to any number of object instances.</td></tr> <tr><td style="text-align:left;"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-request" target="_blank" rel="noopener noreferrer">request<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">Scopes a single bean definition to the lifecycle of a single HTTP request. That is, each HTTP request has its own instance of a bean created off the back of a single bean definition. Only valid in the context of a web-aware Spring <code>ApplicationContext</code>.</td></tr> <tr><td style="text-align:left;"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-session" target="_blank" rel="noopener noreferrer">session<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">Scopes a single bean definition to the lifecycle of an HTTP <code>Session</code>. Only valid in the context of a web-aware Spring <code>ApplicationContext</code>.</td></tr> <tr><td style="text-align:left;"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-application" target="_blank" rel="noopener noreferrer">application<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">Scopes a single bean definition to the lifecycle of a <code>ServletContext</code>. Only valid in the context of a web-aware Spring <code>ApplicationContext</code>.</td></tr> <tr><td style="text-align:left;"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#websocket-stomp-websocket-scope" target="_blank" rel="noopener noreferrer">websocket<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">Scopes a single bean definition to the lifecycle of a <code>WebSocket</code>. Only valid in the context of a web-aware Spring <code>ApplicationContext</code>.</td></tr></tbody></table> <h4 id="_1-5-1-the-singleton-scope"><a href="#_1-5-1-the-singleton-scope" class="header-anchor">#</a> 1.5.1. The Singleton Scope</h4> <p>Only one shared instance of a singleton bean is managed, and all requests for beans with an ID or IDs that match that bean definition result in that one specific bean instance being returned by the Spring container.</p> <p>To put it another way, when you define a bean definition and it is scoped as a singleton, the Spring IoC container creates exactly one instance of the object defined by that bean definition. This single instance is stored in a cache of such singleton beans, and all subsequent requests and references for that named bean return the cached object. The following image shows how the singleton scope works:</p> <p><img src="https://docs.spring.io/spring-framework/docs/current/reference/html/images/singleton.png" alt="singleton"></p> <p>Spring’s concept of a singleton bean differs from the singleton pattern as defined in the Gang of Four (GoF) patterns book. The GoF singleton hard-codes the scope of an object such that one and only one instance of a particular class is created per ClassLoader. The scope of the Spring singleton is best described as being per-container and per-bean. This means that, if you define one bean for a particular class in a single Spring container, the Spring container creates one and only one instance of the class defined by that bean definition. The singleton scope is the default scope in Spring. To define a bean as a singleton in XML, you can define a bean as shown in the following example:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>accountService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.something.DefaultAccountService<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token comment">&lt;!-- the following is equivalent, though redundant (singleton scope is the default) --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>accountService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.something.DefaultAccountService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>singleton<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></blockquote> <p>上面一大段英文，提取重点如下（欢迎补充）：</p> <ul><li>bean的定义，需要有作用域的定义；</li> <li>Spring的作用域灵活且强大，因为可以通过配置来指定，而不用像java一样在Class级别去设置；</li> <li>Spring默认提供了6种作用域，默认是单例；</li> <li>单例指定的bean，在一个Spring IoC容器中，只会有一个实例；</li> <li>GoF的单例和Spring的单例概念略有不同（私以为主要在实现上，Spring就想宣传所谓强大）；</li></ul> <p>到这里，基本知道单例是个什么东西了，但是书中的那句话一直让我耿耿于怀</p> <blockquote><p>在大多数情况下，单例bean是很理想的方案。</p></blockquote> <h2 id="_2-为什么说-在大多数情况下-单例bean是很理想的方案"><a href="#_2-为什么说-在大多数情况下-单例bean是很理想的方案" class="header-anchor">#</a> 2 为什么说&quot;在大多数情况下，单例bean是很理想的方案&quot;？</h2> <p>遍查资料，会发现都没仔细的分析，我们不如自己假设来看下。</p> <p>这句话说的大多数情况，1个bean实例就够了；那反过来说，某些情况下，每次都要有相同定义下的不同bean来提供服务。那这是哪些情况呢？我理解应该就是每次都需要new一个的时候。</p> <p>那现在问题就是，需要通过new来实例的对象有什么特点？</p> <p>结合项目，会发现这种对象往往是所谓的“失血模型”，即我们项目中，什么entity、model包下的这种bean。这种实例，都是通过java的new语句来的，并不是事先就注入到Spring容器中的诶....</p> <p>尴尬了，Spring中找到多例的case都少，那得证的就是单例真的足够用了。</p> <p>为啥呢？还是为啥呢？</p> <p>比如说，某个@Service注解的服务类，其实只需要这一个类去提供服务了；如果有多个这个实例的话，其实服务来说是OK的，但是确实成本更高的。这点，书中其实也说到了</p> <blockquote><p>初始化和垃圾回收对象实例所带来的成本只留给一些小规模任务...</p></blockquote> <p>但其实在网上大量的文章中，都说的是，Java的单例模式针对的是无状态的对象，和Spring的单例看来真的是相差甚远。</p> <h2 id="_3-多聊一下对象的状态-以及单例模式"><a href="#_3-多聊一下对象的状态-以及单例模式" class="header-anchor">#</a> 3 多聊一下对象的状态，以及单例模式</h2> <p>Java对象的状态是什么？网上的说法就是，类的定义中有变量的这种，且在类的方法中可以修改这些变量的。</p> <p>我们还是找下比较权威的说法：</p> <blockquote><ul><li>对象的状态（state）——当施加那些方法时，对象如何响应？</li></ul> <p>每个对象都保存着描述当前特征的信息。这就是对象的状态。对象的状态可能会随着时间而发生改变，但这种改变不会是自发的。对象状态的改变必须通过调用方法实现（如果不经过方法调用就可以改变对象状态，只能说明封装性遭到了破坏）。</p></blockquote> <p>网上说的还是没啥问题的。</p> <p>所以就是说，有状态的对象，不一定适用于单例，反之亦然。</p> <p>那简单写一个线程安全的单例模式：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/**
         * 效率角度考虑，外层空判断
         */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/**
             * 判空和实例化加锁，保证线程安全，只有一个实例
             */</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>至于Spring是怎么保证容器中只有一个bean的，这个还需要看下上下文怎么取bean的源码的，但好像目前不是很关心。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li>Spring in action 第4版</li> <li>Spring官方文档</li> <li>Java核心技术卷1</li></ul></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/andy1202go/to-life/edit/main/docs/01.入门/02.正式入门/02.编程语言/01.为什么Spring的bean默认都是单例？.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">8/25/2022, 4:19:12 PM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/to-life/pages/4a3445/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">编程技巧学习资源</div></a> <a href="/to-life/pages/e71bfc/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Java核心技术卷1（原书第9版）目录及概述</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/to-life/pages/4a3445/" class="prev">编程技巧学习资源</a></span> <span class="next"><a href="/to-life/pages/e71bfc/">Java核心技术卷1（原书第9版）目录及概述</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://github.com/andy1202go" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="mailto:andy1202go@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/andy1202go" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>Eryajf | <a href="https://github.com/eryajf/to-life/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----></div></div>
    <script src="/to-life/assets/js/app.3dedcccd.js" defer></script><script src="/to-life/assets/js/4.c9433221.js" defer></script><script src="/to-life/assets/js/29.da8f1ff4.js" defer></script>
  </body>
</html>
